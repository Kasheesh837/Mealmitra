{% extends "base.html" %}

{% block title %}Volunteer Dashboard - Annasamarpan{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<section class="bg-gradient-to-r from-green-600 to-blue-600 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center text-white">
            <h1 class="text-4xl font-bold mb-4">
                <i class="fas fa-tachometer-alt mr-3"></i>Volunteer Dashboard
            </h1>
            <p class="text-xl text-green-100">Welcome back, {{ volunteer.name }}!</p>
        </div>
    </div>
</section>

<!-- Dashboard Stats -->
<section class="py-12 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Total Assignments -->
            <div class="bg-white rounded-2xl p-6 shadow-lg card-hover">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-tasks text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-gray-800">{{ assignments|length }}</div>
                        <div class="text-gray-600">Total Assignments</div>
                    </div>
                </div>
            </div>
            
            <!-- Completed -->
            <div class="bg-white rounded-2xl p-6 shadow-lg card-hover">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-check-circle text-green-600 text-xl"></i>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-gray-800">
                            {{ assignments|selectattr('status', 'equalto', 'completed')|list|length }}
                        </div>
                        <div class="text-gray-600">Completed</div>
                    </div>
                </div>
            </div>
            
            <!-- Pending -->
            <div class="bg-white rounded-2xl p-6 shadow-lg card-hover">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-clock text-yellow-600 text-xl"></i>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-gray-800">
                            {{ assignments|selectattr('status', 'equalto', 'assigned')|list|length }}
                        </div>
                        <div class="text-gray-600">Pending</div>
                    </div>
                </div>
            </div>
            
            <!-- Availability -->
            <div class="bg-white rounded-2xl p-6 shadow-lg card-hover">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mr-4">
                        <i class="fas fa-user-check text-purple-600 text-xl"></i>
                    </div>
                    <div>
                        <div class="text-lg font-bold text-gray-800 capitalize">{{ volunteer.availability }}</div>
                        <div class="text-gray-600">Status</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Assignments Section -->
<section class="py-12 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-3xl font-bold text-gray-800">Your Assignments</h2>
            <div class="flex space-x-4">
                <button onclick="refreshAssignments()" 
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                    <i class="fas fa-sync-alt mr-2"></i>Refresh
                </button>
            </div>
        </div>
        
        {% if assignments %}
            <div class="space-y-6">
                {% for assignment in assignments %}
                <div class="bg-white rounded-2xl shadow-lg border-l-4 {% if assignment.status == 'completed' %}border-green-500{% elif assignment.status == 'assigned' %}border-yellow-500{% else %}border-gray-500{% endif %}">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-semibold text-gray-800 mb-2">
                                    Assignment #{{ loop.index }}
                                </h3>
                                <div class="flex items-center space-x-4 text-sm text-gray-600">
                                    <span class="flex items-center">
                                        <i class="fas fa-calendar mr-2"></i>
                                        {{ assignment.assigned_at.strftime('%B %d, %Y') if assignment.assigned_at else 'N/A' }}
                                    </span>
                                    <span class="flex items-center">
                                        <i class="fas fa-clock mr-2"></i>
                                        {{ assignment.assigned_at.strftime('%I:%M %p') if assignment.assigned_at else 'N/A' }}
                                    </span>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium
                                    {% if assignment.status == 'completed' %}bg-green-100 text-green-800{% elif assignment.status == 'assigned' %}bg-yellow-100 text-yellow-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                                    {% if assignment.status == 'completed' %}
                                        <i class="fas fa-check-circle mr-1"></i>Completed
                                    {% elif assignment.status == 'assigned' %}
                                        <i class="fas fa-clock mr-1"></i>Assigned
                                    {% else %}
                                        <i class="fas fa-question-circle mr-1"></i>{{ assignment.status|title }}
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                        
                        {% if assignment.donation %}
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <!-- Donation Details -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <i class="fas fa-gift mr-2 text-blue-600"></i>Donation Details
                                </h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Food Type:</span>
                                        <span class="font-medium">{{ assignment.donation.food_type.replace('_', ' ').title() }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Quantity:</span>
                                        <span class="font-medium">{{ assignment.donation.quantity }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Description:</span>
                                        <span class="font-medium">{{ assignment.donation.description[:50] }}{% if assignment.donation.description|length > 50 %}...{% endif %}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pickup Details -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3 flex items-center">
                                    <i class="fas fa-map-marker-alt mr-2 text-green-600"></i>Pickup Details
                                </h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Address:</span>
                                        <span class="font-medium">{{ assignment.donation.pickup_address[:30] }}{% if assignment.donation.pickup_address|length > 30 %}...{% endif %}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Donor Contact:</span>
                                        <span class="font-medium">{{ assignment.donation.donor_email }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Full Description -->
                        <div class="mb-6">
                            <h4 class="font-semibold text-gray-800 mb-2">Full Description</h4>
                            <p class="text-gray-700 bg-gray-50 rounded-lg p-4">{{ assignment.donation.description }}</p>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex justify-end space-x-4">
                            {% if assignment.status == 'assigned' %}
                                <button onclick="confirmDelivery('{{ assignment._id }}')" 
                                        class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors duration-200">
                                    <i class="fas fa-check mr-2"></i>Mark as Delivered
                                </button>
                                <button onclick="viewDetails('{{ assignment._id }}')" 
                                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                                    <i class="fas fa-eye mr-2"></i>View Details
                                </button>
                            {% elif assignment.status == 'completed' %}
                                <span class="text-green-600 font-medium flex items-center">
                                    <i class="fas fa-check-circle mr-2"></i>Successfully Delivered
                                </span>
                            {% endif %}
                        </div>
                        {% else %}
                        <div class="text-center py-8 text-gray-500">
                            <i class="fas fa-exclamation-triangle text-3xl mb-4"></i>
                            <p>Donation details not available</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- No Assignments -->
            <div class="text-center py-16">
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-inbox text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-800 mb-4">No Assignments Yet</h3>
                <p class="text-gray-600 mb-6 max-w-md mx-auto">
                    You don't have any assignments yet. We'll notify you via email when a donation becomes available in your area.
                </p>
                <div class="flex justify-center space-x-4">
                    <button onclick="refreshAssignments()" 
                            class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-sync-alt mr-2"></i>Check for New Assignments
                    </button>
                </div>
            </div>
        {% endif %}
    </div>
</section>

<!-- Profile Information -->
<section class="py-12 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-2xl shadow-lg p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-user mr-3 text-blue-600"></i>Your Profile
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Personal Info -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Personal Information</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Name:</span>
                            <span class="font-medium">{{ volunteer.name }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Email:</span>
                            <span class="font-medium">{{ volunteer.email }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Phone:</span>
                            <span class="font-medium">{{ volunteer.phone }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">City:</span>
                            <span class="font-medium">{{ volunteer.city }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Address Info -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Address Information</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Address:</span>
                            <span class="font-medium">{{ volunteer.address }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">State:</span>
                            <span class="font-medium">{{ volunteer.state }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Pincode:</span>
                            <span class="font-medium">{{ volunteer.pincode }}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Availability:</span>
                            <span class="font-medium capitalize">{{ volunteer.availability }}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-gray-200">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800">Volunteer Since</h3>
                        <p class="text-gray-600">{{ volunteer.created_at.strftime('%B %d, %Y') if volunteer.created_at else 'N/A' }}</p>
                    </div>
                    <button onclick="updateProfile()" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200">
                        <i class="fas fa-edit mr-2"></i>Update Profile
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    function refreshAssignments() {
        location.reload();
    }
    
    function confirmDelivery(assignmentId) {
        if (confirm('Are you sure you have successfully delivered this donation?')) {
            // Here you would typically make an API call to update the assignment status
            // For now, we'll just show a success message
            alert('Delivery confirmed! Thank you for your service.');
            location.reload();
        }
    }
    
    function viewDetails(assignmentId) {
        // Here you would typically open a modal or navigate to a details page
        alert('Viewing assignment details...');
    }
    
    function updateProfile() {
        // Here you would typically open a profile update form
        alert('Profile update feature coming soon!');
    }
    
    // Auto-refresh every 5 minutes
    setInterval(function() {
        // Check for new assignments
        fetch('/api/volunteer/assignments')
            .then(response => response.json())
            .then(data => {
                if (data.newAssignments > 0) {
                    // Show notification
                    showNotification('You have ' + data.newAssignments + ' new assignment(s)!');
                }
            })
            .catch(error => console.log('Error checking for new assignments:', error));
    }, 300000); // 5 minutes
    
    function showNotification(message) {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50';
        notification.innerHTML = '<i class="fas fa-bell mr-2"></i>' + message;
        
        document.body.appendChild(notification);
        
        // Remove after 5 seconds
        setTimeout(() => {
            notification.remove();
        }, 5000);
    }
</script>
{% endblock %}
